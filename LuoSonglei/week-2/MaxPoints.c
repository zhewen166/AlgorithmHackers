#include"utils.h"

struct Point{
    int x;
    int y;
}Point;

/*******************************************
Author: LHearen
E-mail: LHearen@126.com
Time  :	2015-12-13 14:53
Description: 
Source: https://leetcode.com/problems/max-points-on-a-line/
*******************************************/
#define TEST 0
//test cases:
//[[40,-23],[9,138],[429,115],[50,-17],[-3,80],[-10,33],[5,-21],[-3,80],[-6,-65],[-18,26],[-6,-65],[5,72],[0,77],[-9,86],[10,-2],[-8,85],[21,130],[18,-6],[-18,26],[-1,-15],[10,-2],[8,69],[-4,63],[0,3],[-4,40],[-7,84],[-8,7],[30,154],[16,-5],[6,90],[18,-6],[5,77],[-4,77],[7,-13],[-1,-45],[16,-5],[-9,86],[-16,11],[-7,84],[1,76],[3,77],[10,67],[1,-37],[-10,-81],[4,-11],[-20,13],[-10,77],[6,-17],[-27,2],[-10,-81],[10,-1],[-9,1],[-8,43],[2,2],[2,-21],[3,82],[8,-1],[10,-1],[-9,1],[-12,42],[16,-5],[-5,-61],[20,-7],[9,-35],[10,6],[12,106],[5,-21],[-5,82],[6,71],[-15,34],[-10,87],[-14,-12],[12,106],[-5,82],[-46,-45],[-4,63],[16,-5],[4,1],[-3,-53],[0,-17],[9,98],[-18,26],[-9,86],[2,77],[-2,-49],[1,76],[-3,-38],[-8,7],[-17,-37],[5,72],[10,-37],[-4,-57],[-3,-53],[3,74],[-3,-11],[-8,7],[1,88],[-12,42],[1,-37],[2,77],[-6,77],[5,72],[-4,-57],[-18,-33],[-12,42],[-9,86],[2,77],[-8,77],[-3,77],[9,-42],[16,41],[-29,-37],[0,-41],[-21,18],[-27,-34],[0,77],[3,74],[-7,-69],[-21,18],[27,146],[-20,13],[21,130],[-6,-65],[14,-4],[0,3],[9,-5],[6,-29],[-2,73],[-1,-15],[1,76],[-4,77],[6,-29]]
//check the y;
//[[84,250],[0,0],[1,0],[0,-70],[0,-70],[1,-1],[21,10],[42,90],[-42,-230]]
//make sure the first two points are not the same;
//[[0,9],[138,429],[115,359],[115,359],[-30,-102],[230,709],[-150,-686],[-135,-613],[-60,-248],[-161,-481],[207,639],[23,79],[-230,-691],[-115,-341],[92,289],[60,336],[-105,-467],[135,701],[-90,-394],[-184,-551],[150,774]]
//[[1,1],[1,1],[1,1]]
//handle basic exceptions;
//[]
//[[0,0],[1,1][0,0]]

bool isEqual(struct Point pA, struct Point pB)
{
    return pA.x == pB.x && pA.y == pB.y;
}

bool slopeEqual(struct Point pA, struct Point pB, struct Point pC)
{
    #ifdef TEST1
        printf("pA - x: %d\t y: %d\n", pA.x, pA.y);
        printf("pB - x: %d\t y: %d\n", pB.x, pB.y);
        printf("pC - x: %d\t y: %d\n", pC.x, pC.y);
    #endif
    if(pA.y == pB.y || pA.y == pC.y)
    {
        if(pA.y == pB.y && pA.y == pC.y)
            return true;
        //in case of repitition;
        if(pA.y == pB.y && pA.x == pB.x)
            return true;
        if(pA.y == pC.y && pA.x == pC.x)
            return true;
        return false;
    }
    if((double)(pA.x - pB.x) / (pA.y - pB.y) == (double)(pA.x - pC.x) / (pA.y - pC.y))
        return true;
    return false;
}

int maxPoints(struct Point* points, int pointsSize)
{
    if(pointsSize < 3)
        return pointsSize;
    int count = 1;
    int max = 2;
    for(int i = 0; i < pointsSize; i++)
        for(int j = i + 1; j < pointsSize; j++)
        {
            //collect the repeated points between i and j;
            for(int h = i + 1; h < j; h++)
                if(isEqual(points[i], points[h]))
                    count++;
            //find a different point;
            //all the same will be skipped and counted;
            for(;j < pointsSize && isEqual(points[i], points[j]); j++, count++);
            //the first different point;
            if(j < pointsSize)
                count++; 
            for(int k = j + 1; k < pointsSize; k++)
            {
                #ifdef TEST
                    printf("i: %d\t: %d\tk: %d\n", i,j,k);
                #endif
                //save invalid checking loop;
                if(max > count + pointsSize - k + 1)
                    break;
                if(slopeEqual(points[i], points[j], points[k]))
                    count++;
                #ifdef TEST
                    printf("count: %d\n", count);
                #endif
            }
            if(count > max)
                max = count;
            count = 1;
        }
    return max;
}

void main()
{
    struct Point points[] = 
        {{40,-23},{9,138},{429,115},{50,-17},{-3,80},{-10,33},{5,-21},{-3,80},{-6,-65},{-18,26},{-6,-65},{5,72},{0,77},{-9,86},{10,-2},{-8,85},{21,130},{18,-6},{-18,26},{-1,-15},{10,-2},{8,69},{-4,63},{0,3},{-4,40},{-7,84},{-8,7},{30,154},{16,-5},{6,90},{18,-6},{5,77},{-4,77},{7,-13},{-1,-45},{16,-5},{-9,86},{-16,11},{-7,84},{1,76},{3,77},{10,67},{1,-37},{-10,-81},{4,-11},{-20,13},{-10,77},{6,-17},{-27,2},{-10,-81},{10,-1},{-9,1},{-8,43},{2,2},{2,-21},{3,82},{8,-1},{10,-1},{-9,1},{-12,42},{16,-5},{-5,-61},{20,-7},{9,-35},{10,6},{12,106},{5,-21},{-5,82},{6,71},{-15,34},{-10,87},{-14,-12},{12,106},{-5,82},{-46,-45},{-4,63},{16,-5},{4,1},{-3,-53},{0,-17},{9,98},{-18,26},{-9,86},{2,77},{-2,-49},{1,76},{-3,-38},{-8,7},{-17,-37},{5,72},{10,-37},{-4,-57},{-3,-53},{3,74},{-3,-11},{-8,7},{1,88},{-12,42},{1,-37},{2,77},{-6,77},{5,72},{-4,-57},{-18,-33},{-12,42},{-9,86},{2,77},{-8,77},{-3,77},{9,-42},{16,41},{-29,-37},{0,-41},{-21,18},{-27,-34},{0,77},{3,74},{-7,-69},{-21,18},{27,146},{-20,13},{21,130},{-6,-65},{14,-4},{0,3},{9,-5},{6,-29},{-2,73},{-1,-15},{1,76},{-4,77},{6,-29}};
    int pointsSize = sizeof(points) / sizeof(struct Point);

    int result = maxPoints(points, pointsSize);
    printf("%d\n", result);
}
